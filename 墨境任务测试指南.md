# 墨境任务系统功能测试指南

## 测试前准备

1. 启动后端服务器
```bash
cd server
npm start
```

2. 启动前端开发服务器
```bash
cd client
npm run dev
```

## 测试用例

### 1. 今日任务显示测试

**步骤：**
1. 打开浏览器访问墨境任务页面 `/mojing/tasks`
2. 查看页面显示的今日任务

**预期结果：**
- ✅ 顶部统计卡显示：已完成/总任务/今日XP
- ✅ 显示未完成的任务（最多6个：3墨点+3墨线）
- ✅ 显示所有已完成的任务（带✓图标，半透明）
- ✅ 任务卡片显示：标题、描述、属性标签、XP、难度

### 2. 完成任务并查看更新

**步骤：**
1. 点击一个未完成的任务
2. 输入内容并提交
3. 返回任务列表

**预期结果：**
- ✅ 该任务变为已完成状态（带✓图标）
- ✅ 顶部统计数字更新
- ✅ 今日XP增加

### 3. 已完成任务列表测试

**步骤：**
1. 切换到"已完成"标签
2. 查看已完成任务列表

**预期结果：**
- ✅ 显示所有历史完成的任务
- ✅ 每个任务显示：练习次数、最高分、最后练习时间
- ✅ 有"再次练习"按钮

### 4. 筛选功能测试

**步骤：**
1. 在已完成视图中，使用筛选器
2. 分别测试：
   - 按任务类型筛选（墨点/墨线）
   - 按属性类型筛选（人物力/冲突力等）

**预期结果：**
- ✅ 列表根据筛选条件更新
- ✅ 只显示符合条件的任务

### 5. 再次练习功能测试

**步骤：**
1. 在已完成任务列表中，找一个已完成的任务
2. 点击"再次练习"按钮
3. 在弹出的确认对话框中点击"开始练习"

**预期结果：**
- ✅ 弹出确认对话框
- ✅ 确认后跳转到任务详情页
- ✅ 内容区域为空（新的练习）
- ✅ 可以正常输入和提交

### 6. 查看练习历史测试

**步骤：**
1. 先对同一个任务练习2-3次
2. 在已完成任务列表中，点击该任务卡片（不是"再次练习"按钮）

**预期结果：**
- ✅ 弹出历史记录对话框
- ✅ 显示任务标题和统计（总练习次数、完成次数、最高分）
- ✅ 列出所有练习记录，包含：
  - 练习编号（#1, #2, ...）
  - 日期时间
  - 分数（如有）
  - 内容预览
  - 字数、耗时、获得XP
- ✅ 可以展开查看详细AI评审

### 7. 历史记录内容验证

**步骤：**
1. 在历史记录对话框中，展开一条记录的评审详情

**预期结果：**
- ✅ 显示维度评分
- ✅ 显示亮点
- ✅ 显示改进建议
- ✅ 显示总评

### 8. 分页加载测试

**步骤：**
1. 如果已完成任务超过20个
2. 滚动到列表底部
3. 点击"加载更多"按钮

**预期结果：**
- ✅ 加载更多任务
- ✅ 新任务追加到列表末尾
- ✅ 如果没有更多任务，按钮消失

### 9. 移动端适配测试

**步骤：**
1. 使用浏览器开发者工具切换到移动设备模式
2. 重新测试上述功能

**预期结果：**
- ✅ 布局适配移动屏幕
- ✅ 所有按钮和交互正常
- ✅ 对话框宽度适配

## API测试（可选）

可以使用 Postman 或 curl 测试后端API：

### 获取今日任务
```bash
curl http://localhost:3000/api/mojing/tasks/today
```

### 获取已完成任务
```bash
curl http://localhost:3000/api/mojing/tasks/completed?limit=10&offset=0
```

### 获取任务历史
```bash
curl http://localhost:3000/api/mojing/tasks/1/history
```

### 开始再次练习
```bash
curl -X POST http://localhost:3000/api/mojing/tasks/1/practice
```

## 常见问题排查

### 问题1：已完成任务不显示
**排查：**
- 检查数据库中 `mojing_task_records` 表是否有 status='completed' 的记录
- 检查浏览器控制台是否有错误
- 检查后端日志

### 问题2：再次练习失败
**排查：**
- 确认任务至少完成过一次
- 检查后端返回的错误信息
- 查看数据库中是否创建了新的 record

### 问题3：历史记录对话框为空
**排查：**
- 检查任务ID是否正确
- 查看API响应数据
- 确认 ai_feedback 字段格式是否正确

### 问题4：统计数字不对
**排查：**
- 刷新页面重新加载
- 检查今日任务的日期是否正确
- 查看数据库中的 task_date 字段

## 测试数据建议

为了全面测试功能，建议准备：
- 至少6个未完成任务（3墨点+3墨线）
- 至少5个已完成任务
- 至少1个任务有多次练习记录（2-3次）

## 测试完成标准

所有测试用例通过（✅），且：
- 无JavaScript错误
- 无网络请求失败
- 页面交互流畅
- 数据显示准确
